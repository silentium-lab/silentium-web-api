{"version":3,"file":"silentium-web-api.mjs","sources":["../src/fetch/FetchedData.ts","../src/fetch/RequestJson.ts","../src/dom/Elements.ts","../src/dom/Element.ts","../src/console/Log.ts","../src/timer/Timer.ts"],"sourcesContent":["import { Message, MessageType, Tap, TapType } from \"silentium\";\n\nexport interface FetchRequestType {\n  baseUrl?: string;\n  url: string;\n  method: string;\n  credentials?: RequestCredentials;\n  headers?: Record<string, string>;\n  body?: unknown;\n  query?: Record<string, unknown>;\n}\n\n/**\n * Wrapper around FetchAPI\n * https://kosukhin.github.io/patron-web-api/#/fetch/fetched\n * https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\n */\nexport function FetchedData(\n  $request: MessageType<Partial<FetchRequestType>>,\n  error?: TapType,\n  $abort?: MessageType,\n) {\n  return Message<string>(function () {\n    const abortController = new AbortController();\n    if ($abort) {\n      $abort.pipe(\n        Tap((abort) => {\n          if (abort) {\n            abortController.abort();\n          }\n        }),\n      );\n    }\n    $request.pipe(\n      Tap((request) => {\n        const { baseUrl, url, method, credentials, headers, body, query } =\n          request;\n        let urlWithQuery: URL;\n        try {\n          urlWithQuery = new URL(String(url), baseUrl);\n        } catch {\n          error?.use(new Error(\"Invalid URL\"));\n          return;\n        }\n        Object.entries(query ?? {}).forEach(([key, value]) =>\n          urlWithQuery.searchParams.append(key, String(value)),\n        );\n        const options: RequestInit = {\n          method,\n          credentials,\n          headers,\n          body: body as BodyInit,\n          signal: abortController.signal,\n        };\n        fetch(urlWithQuery.toString(), options)\n          .then((response) => response.text())\n          .then((data) => this.use(data))\n          .catch((error) => {\n            error?.(error);\n          });\n      }),\n    );\n  });\n}\n","import { Message, MessageType, Tap, TapType } from \"silentium\";\nimport { FetchRequestType } from \"./FetchedData\";\n\n/**\n * Represents a request for JSON data.\n */\nexport function RequestJson(\n  $request: MessageType<Partial<FetchRequestType>>,\n  error?: TapType,\n) {\n  return Message<Partial<FetchRequestType>>(function () {\n    $request.pipe(\n      Tap((r) => {\n        try {\n          this.use({\n            ...r,\n            headers: {\n              ...(r.headers ?? {}),\n              \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify(r.body),\n          });\n        } catch {\n          error?.use(new Error(\"Failed to parse JSON\"));\n        }\n      }),\n    );\n  });\n}\n","import { Message, MessageType, Tap } from \"silentium\";\n\n/**\n * Represents a collection of elements that match a given CSS selector.\n */\nexport function Elements<T extends HTMLElement>(\n  $selector: MessageType<string>,\n) {\n  return Message<T[]>(function () {\n    $selector.pipe(\n      Tap((selector) => {\n        const element = document.querySelectorAll(selector);\n        if (element.length > 0) {\n          this.use(Array.from(element) as T[]);\n        } else {\n          const targetNode = document;\n          const config = {\n            childList: true,\n            subtree: true,\n            attributes: true,\n            attributeFilter: [\"class\", \"id\"],\n          };\n\n          const observer = new MutationObserver((mutationsList) => {\n            for (const mutation of mutationsList) {\n              if (mutation.type === \"childList\") {\n                // Check if any added nodes match the selector or contain matching elements\n                const checkNodes = (nodes: NodeList) => {\n                  for (const node of Array.from(nodes)) {\n                    if (node.nodeType === Node.ELEMENT_NODE) {\n                      const element = node as Element;\n                      if (element.matches && element.matches(selector)) {\n                        const allElements = document.querySelectorAll(selector);\n                        if (allElements.length > 0) {\n                          this.use(Array.from(allElements) as T[]);\n                          observer.disconnect();\n                          return true;\n                        }\n                      }\n                      // Check if this node contains matching elements\n                      if (\n                        element.querySelector &&\n                        element.querySelector(selector)\n                      ) {\n                        const allElements = document.querySelectorAll(selector);\n                        if (allElements.length > 0) {\n                          this.use(Array.from(allElements) as T[]);\n                          observer.disconnect();\n                          return true;\n                        }\n                      }\n                    }\n                  }\n                  return false;\n                };\n\n                if (checkNodes(mutation.addedNodes)) {\n                  break;\n                }\n              } else if (mutation.type === \"attributes\") {\n                // Check if the mutated element now matches the selector\n                const target = mutation.target as Element;\n                if (target.matches && target.matches(selector)) {\n                  const allElements = document.querySelectorAll(selector);\n                  if (allElements.length > 0) {\n                    this.use(Array.from(allElements) as T[]);\n                    observer.disconnect();\n                    break;\n                  }\n                }\n              }\n            }\n          });\n\n          observer.observe(targetNode, config);\n        }\n      }),\n    );\n  });\n}\n","import { Message, MessageType, Tap } from \"silentium\";\n\n/**\n * Represents an element that matches a given CSS selector.\n * If the element exists immediately, returns it.\n * If not, waits for it to appear in the DOM.\n */\nexport function Element<T extends HTMLElement>($selector: MessageType<string>) {\n  return Message<T | null>(function () {\n    $selector.pipe(\n      Tap((selector) => {\n        const element = document.querySelector(selector) as T | null;\n        if (element) {\n          this.use(element);\n        } else {\n          const targetNode = document;\n          const config = {\n            childList: true,\n            subtree: true,\n            attributes: true,\n            attributeFilter: [\"class\", \"id\"],\n          };\n\n          const observer = new MutationObserver((mutationsList) => {\n            for (const mutation of mutationsList) {\n              if (mutation.type === \"childList\") {\n                // Check added nodes and their descendants\n                const checkNodes = (nodes: NodeList) => {\n                  for (const node of Array.from(nodes)) {\n                    if (node.nodeType === Node.ELEMENT_NODE) {\n                      const element = node as Element;\n                      if (element.matches && element.matches(selector)) {\n                        this.use(element as T);\n                        observer.disconnect();\n                        return true;\n                      }\n                      // Check descendants\n                      if (\n                        element.querySelector &&\n                        element.querySelector(selector)\n                      ) {\n                        const found = element.querySelector(selector) as T;\n                        this.use(found);\n                        observer.disconnect();\n                        return true;\n                      }\n                    }\n                  }\n                  return false;\n                };\n\n                if (checkNodes(mutation.addedNodes)) {\n                  break;\n                }\n              } else if (mutation.type === \"attributes\") {\n                // Check if the mutated element now matches the selector\n                const target = mutation.target as Element;\n                if (target.matches && target.matches(selector)) {\n                  this.use(target as T);\n                  observer.disconnect();\n                  break;\n                }\n              }\n            }\n          });\n\n          observer.observe(targetNode, config);\n        }\n      }),\n    );\n  });\n}\n","import { Tap, TapType } from \"silentium\";\n\n/**\n * Transport for log values to console\n */\nexport function Log<T>(group: string): TapType {\n  return Tap<T>((v) => {\n    console.log(group, v);\n  });\n}\n","import { Message } from \"silentium\";\n\nexport function Timer(delay: number) {\n  return Message<number>((t) => {\n    setTimeout(() => {\n      t.use(delay);\n    }, delay);\n  });\n}\n"],"names":["error","element"],"mappings":"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"}