{"version":3,"file":"silentium-web-api.mjs","sources":["../src/fetch/FetchedData.ts","../src/fetch/RequestJson.ts","../src/dom/Elements.ts","../src/console/Log.ts","../src/timer/Timer.ts"],"sourcesContent":["import { Event, EventType, Transport, TransportType } from \"silentium\";\n\nexport interface FetchRequestType {\n  baseUrl?: string;\n  url: string;\n  method: string;\n  credentials?: RequestCredentials;\n  headers?: Record<string, string>;\n  body?: unknown;\n  query?: Record<string, unknown>;\n}\n\n/**\n * Wrapper around FetchAPI\n * https://kosukhin.github.io/patron-web-api/#/fetch/fetched\n * https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\n */\nexport function FetchedData(\n  $request: EventType<Partial<FetchRequestType>>,\n  error?: TransportType,\n  $abort?: EventType,\n): EventType<string> {\n  return Event((u) => {\n    const abortController = new AbortController();\n    if ($abort) {\n      $abort.event(\n        Transport((abort) => {\n          if (abort) {\n            abortController.abort();\n          }\n        }),\n      );\n    }\n    $request.event(\n      Transport((request) => {\n        const { baseUrl, url, method, credentials, headers, body, query } =\n          request;\n        let urlWithQuery: URL;\n        try {\n          urlWithQuery = new URL(String(url), baseUrl);\n        } catch {\n          error?.use(new Error(\"Invalid URL\"));\n          return;\n        }\n        Object.entries(query ?? {}).forEach(([key, value]) =>\n          urlWithQuery.searchParams.append(key, String(value)),\n        );\n        const options: RequestInit = {\n          method,\n          credentials,\n          headers,\n          body: body as BodyInit,\n          signal: abortController.signal,\n        };\n        fetch(urlWithQuery.toString(), options)\n          .then((response) => response.text())\n          .then((data) => u.use(data))\n          .catch((error) => {\n            error?.(error);\n          });\n      }),\n    );\n  });\n}\n","import { Event, EventType, Transport, TransportType } from \"silentium\";\nimport { FetchRequestType } from \"./FetchedData\";\n\n/**\n * Represents a request for JSON data.\n */\nexport function RequestJson(\n  $request: EventType<Partial<FetchRequestType>>,\n  error?: TransportType,\n): EventType<Partial<FetchRequestType>> {\n  return Event((t) => {\n    $request.event(\n      Transport((r) => {\n        try {\n          t.use({\n            ...r,\n            headers: {\n              ...(r.headers ?? {}),\n              \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify(r.body),\n          });\n        } catch {\n          error?.use(new Error(\"Failed to parse JSON\"));\n        }\n      }),\n    );\n  });\n}\n","import { Event, EventType, Transport } from \"silentium\";\n\n/**\n * Represents a collection of elements that match a given CSS selector.\n */\nexport function Elements<T extends HTMLElement>(\n  $selector: EventType<string>,\n): EventType<T[]> {\n  return Event((t) => {\n    $selector.event(\n      Transport((selector) => {\n        const element = document.querySelectorAll(selector);\n        if (element.length) {\n          t.use(Array.from(element) as T[]);\n        } else {\n          const targetNode = document.body;\n          const config = { childList: true, subtree: true };\n\n          const observer = new MutationObserver((mutationsList) => {\n            for (const mutation of mutationsList) {\n              if (mutation.type === \"childList\") {\n                const element = document.querySelectorAll(selector);\n                if (element) {\n                  t.use(Array.from(element) as T[]);\n                  observer.disconnect();\n                  break;\n                }\n              }\n            }\n          });\n\n          observer.observe(targetNode, config);\n        }\n      }),\n    );\n  });\n}\n","import { All, Event, EventType, Transport } from \"silentium\";\n\n/**\n * Helps to print logs to somewhere\n * https://developer.mozilla.org/en-US/docs/Web/API/Console_API\n */\nexport function Log<T>(\n  sourceSrc: EventType<T>,\n  titleSrc: EventType<string>,\n): EventType<T> {\n  return Event((t) => {\n    All(sourceSrc, titleSrc).event(\n      Transport(([source, title]) => {\n        console.log(\"LOG:\", title, source);\n        t.use(source);\n      }),\n    );\n  });\n}\n","import { Event, EventType } from \"silentium\";\n\nexport function Timer(delay: number): EventType<number> {\n  return Event((t) => {\n    setTimeout(() => {\n      t.use(delay);\n    }, delay);\n  });\n}\n"],"names":["error","element"],"mappings":"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"}