import{Message as e,Actual as t,Primitive as r,Late as n,Source as o}from"silentium";function c(t,r){return e((function(e,n){const o=new AbortController;r&&r.then((e=>{e&&o.abort()})),t.then((t=>{const{baseUrl:r,url:c,method:s,credentials:i,headers:a,body:u,query:l}=t;let d;try{d=new URL(String(c),r)}catch{return void n(new Error("Invalid URL"))}Object.entries(l??{}).forEach((([e,t])=>d.searchParams.append(e,String(t))));const f={method:s,credentials:i,headers:a,body:u,signal:o.signal};fetch(d.toString(),f).then((e=>e.text())).then(e).catch(n)}))}))}function s(t){return e((function(e,r){t.then((t=>{try{e({...t,headers:{...t.headers??{},"Content-Type":"application/json"},body:JSON.stringify(t.body)})}catch{r(new Error("Failed to parse JSON"))}}))}))}function i(r){const n=t(r);return e((function(e){n.then((t=>{const r=document.querySelectorAll(t);if(r.length>0)e(Array.from(r));else{const r=document,n={childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","id"]},o=new MutationObserver((r=>{for(const n of r)if("childList"===n.type){if((r=>{for(const n of Array.from(r))if(n.nodeType===Node.ELEMENT_NODE){const r=n;if(r.matches&&r.matches(t)){const r=document.querySelectorAll(t);if(r.length>0)return e(Array.from(r)),o.disconnect(),!0}if(r.querySelector&&r.querySelector(t)){const r=document.querySelectorAll(t);if(r.length>0)return e(Array.from(r)),o.disconnect(),!0}}return!1})(n.addedNodes))break}else if("attributes"===n.type){const r=n.target;if(r.matches&&r.matches(t)){const r=document.querySelectorAll(t);if(r.length>0){e(Array.from(r)),o.disconnect();break}}}}));o.observe(r,n)}}))}))}function a(r){const n=t(r);return e((function(e){n.then((t=>{const r=document.querySelector(t);if(r)e(r);else{const r=document,n={childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","id"]},o=new MutationObserver((r=>{for(const n of r)if("childList"===n.type){if((r=>{for(const n of Array.from(r))if(n.nodeType===Node.ELEMENT_NODE){const r=n;if(r.matches&&r.matches(t))return e(r),o.disconnect(),!0;if(r.querySelector&&r.querySelector(t)){const n=r.querySelector(t);return e(n),o.disconnect(),!0}}return!1})(n.addedNodes))break}else if("attributes"===n.type){const r=n.target;if(r.matches&&r.matches(t)){e(r),o.disconnect();break}}}));o.observe(r,n)}}))}))}function u(e){return t=>{console.log(e,t)}}function l(t){return e((e=>{setTimeout((()=>{e(t)}),t)}))}function d(e,t,c="localStorage"){const s=r(e),i=n();return o((r=>{i.then(r);const n=window[c];e.then((e=>{if(window.addEventListener("storage",(r=>{if(r.storageArea===n&&r.key===e){const e=r.newValue?JSON.parse(r.newValue):t;null!=e&&i.use(e)}})),n[e])try{i.use(JSON.parse(n[e]))}catch{console.warn(`LocalStorageRecord cant parse value ${e}`)}else void 0!==t&&i.use(t)}))}),(e=>{const t=window[c];i.use(e);try{t[s.primitiveWithException()]=JSON.stringify(e)}catch{console.warn("LocalStorageRecord cant stringify value")}}))}export{a as Element,i as Elements,c as FetchedData,u as Log,s as RequestJson,d as StorageRecord,l as Timer};
//# sourceMappingURL=silentium-web-api.min.mjs.map
