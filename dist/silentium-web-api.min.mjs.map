{"version":3,"file":"silentium-web-api.min.mjs","sources":["../src/fetch/FetchedData.ts","../src/fetch/RequestJson.ts","../src/dom/Elements.ts","../src/console/Log.ts","../src/timer/Timer.ts"],"sourcesContent":["import { Event, EventType, Transport, TransportType } from \"silentium\";\n\nexport interface FetchRequestType {\n  baseUrl?: string;\n  url: string;\n  method: string;\n  credentials?: RequestCredentials;\n  headers?: Record<string, string>;\n  body?: unknown;\n  query?: Record<string, unknown>;\n}\n\n/**\n * Wrapper around FetchAPI\n * https://kosukhin.github.io/patron-web-api/#/fetch/fetched\n * https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\n */\nexport function FetchedData(\n  $request: EventType<Partial<FetchRequestType>>,\n  error?: TransportType,\n  $abort?: EventType,\n): EventType<string> {\n  return Event((u) => {\n    const abortController = new AbortController();\n    if ($abort) {\n      $abort.event(\n        Transport((abort) => {\n          if (abort) {\n            abortController.abort();\n          }\n        }),\n      );\n    }\n    $request.event(\n      Transport((request) => {\n        const { baseUrl, url, method, credentials, headers, body, query } =\n          request;\n        let urlWithQuery: URL;\n        try {\n          urlWithQuery = new URL(String(url), baseUrl);\n        } catch {\n          error?.use(new Error(\"Invalid URL\"));\n          return;\n        }\n        Object.entries(query ?? {}).forEach(([key, value]) =>\n          urlWithQuery.searchParams.append(key, String(value)),\n        );\n        const options: RequestInit = {\n          method,\n          credentials,\n          headers,\n          body: body as BodyInit,\n          signal: abortController.signal,\n        };\n        fetch(urlWithQuery.toString(), options)\n          .then((response) => response.text())\n          .then((data) => u.use(data))\n          .catch((error) => {\n            error?.(error);\n          });\n      }),\n    );\n  });\n}\n","import { Event, EventType, Transport, TransportType } from \"silentium\";\nimport { FetchRequestType } from \"./FetchedData\";\n\n/**\n * Represents a request for JSON data.\n */\nexport function RequestJson(\n  $request: EventType<Partial<FetchRequestType>>,\n  error?: TransportType,\n): EventType<Partial<FetchRequestType>> {\n  return Event((t) => {\n    $request.event(\n      Transport((r) => {\n        try {\n          t.use({\n            ...r,\n            headers: {\n              ...(r.headers ?? {}),\n              \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify(r.body),\n          });\n        } catch {\n          error?.use(new Error(\"Failed to parse JSON\"));\n        }\n      }),\n    );\n  });\n}\n","import { Event, EventType, Transport } from \"silentium\";\n\n/**\n * Represents a collection of elements that match a given CSS selector.\n */\nexport function Elements<T extends HTMLElement>(\n  $selector: EventType<string>,\n): EventType<T[]> {\n  return Event((t) => {\n    $selector.event(\n      Transport((selector) => {\n        const element = document.querySelectorAll(selector);\n        if (element.length) {\n          t.use(Array.from(element) as T[]);\n        } else {\n          const targetNode = document.body;\n          const config = { childList: true, subtree: true };\n\n          const observer = new MutationObserver((mutationsList) => {\n            for (const mutation of mutationsList) {\n              if (mutation.type === \"childList\") {\n                const element = document.querySelectorAll(selector);\n                if (element) {\n                  t.use(Array.from(element) as T[]);\n                  observer.disconnect();\n                  break;\n                }\n              }\n            }\n          });\n\n          observer.observe(targetNode, config);\n        }\n      }),\n    );\n  });\n}\n","import { Transport, TransportType } from \"silentium\";\n\n/**\n * Transport for log values to console\n */\nexport function Log<T>(group: string): TransportType {\n  return Transport<T>((v) => {\n    console.log(group, v);\n  });\n}\n","import { Event, EventType } from \"silentium\";\n\nexport function Timer(delay: number): EventType<number> {\n  return Event((t) => {\n    setTimeout(() => {\n      t.use(delay);\n    }, delay);\n  });\n}\n"],"names":["FetchedData","$request","error","$abort","Event","u","abortController","AbortController","event","Transport","abort","request","baseUrl","url","method","credentials","headers","body","query","urlWithQuery","URL","String","use","Error","Object","entries","forEach","key","value","searchParams","append","options","signal","fetch","toString","then","response","text","data","catch","RequestJson","t","r","JSON","stringify","Elements","$selector","selector","element","document","querySelectorAll","length","Array","from","targetNode","config","childList","subtree","observer","MutationObserver","mutationsList","mutation","type","disconnect","observe","Log","group","v","console","log","Timer","delay","setTimeout"],"mappings":"iDAiBgB,SAAAA,EACdC,EACAC,EACAC,GAEO,OAAAC,GAAOC,IACN,MAAAC,EAAkB,IAAIC,gBACxBJ,GACKA,EAAAK,MACLC,GAAWC,IACLA,GACFJ,EAAgBI,YAKfT,EAAAO,MACPC,GAAWE,IACH,MAAAC,QAAEA,MAASC,EAAKC,OAAAA,EAAAC,YAAQA,UAAaC,EAASC,KAAAA,EAAAC,MAAMA,GACxDP,EACE,IAAAQ,EACA,IACFA,EAAe,IAAIC,IAAIC,OAAOR,GAAMD,EAAO,CACrC,MAEN,YADAV,GAAOoB,IAAI,IAAIC,MAAM,eACrB,CAEFC,OAAOC,QAAQP,GAAS,CAAA,GAAIQ,SAAQ,EAAEC,EAAKC,KACzCT,EAAaU,aAAaC,OAAOH,EAAKN,OAAOO,MAE/C,MAAMG,EAAuB,CAC3BjB,SACAC,cACAC,UACAC,OACAe,OAAQ1B,EAAgB0B,QAEpBC,MAAAd,EAAae,WAAYH,GAC5BI,MAAMC,GAAaA,EAASC,SAC5BF,MAAMG,GAASjC,EAAEiB,IAAIgB,KACrBC,OAAOrC,IACNA,IAAQA,YAKpB,CCzDgB,SAAAsC,EACdvC,EACAC,GAEO,OAAAE,GAAOqC,IACHxC,EAAAO,MACPC,GAAWiC,IACL,IACFD,EAAEnB,IAAI,IACDoB,EACH1B,QAAS,IACH0B,EAAE1B,SAAW,CAAC,EAClB,eAAgB,oBAElBC,KAAM0B,KAAKC,UAAUF,EAAEzB,OACxB,CACK,MACNf,GAAOoB,IAAI,IAAIC,MAAM,wBAAuB,QAKtD,CCvBO,SAASsB,EACdC,GAEO,OAAA1C,GAAOqC,IACFK,EAAAtC,MACRC,GAAWsC,IACH,MAAAC,EAAUC,SAASC,iBAAiBH,GAC1C,GAAIC,EAAQG,OACVV,EAAEnB,IAAI8B,MAAMC,KAAKL,QACZ,CACL,MAAMM,EAAaL,SAAShC,KACtBsC,EAAS,CAAEC,WAAW,EAAMC,SAAS,GAErCC,EAAW,IAAIC,kBAAkBC,IACrC,IAAA,MAAWC,KAAYD,EACjB,GAAkB,cAAlBC,EAASC,KAAsB,CAC3Bd,MAAAA,EAAUC,SAASC,iBAAiBH,GAC1C,GAAIC,EAAS,CACXP,EAAEnB,IAAI8B,MAAMC,KAAKL,IACjBU,EAASK,aACT,KAAA,CACF,KAKGL,EAAAM,QAAQV,EAAYC,EAAM,QAK7C,CC/BO,SAASU,EAAOC,GACd,OAAAzD,GAAc0D,IACXC,QAAAC,IAAIH,EAAOC,KAEvB,CCPO,SAASG,EAAMC,GACb,OAAAnE,GAAOqC,IACZ+B,YAAW,KACT/B,EAAEnB,IAAIiD,KACLA,KAEP"}