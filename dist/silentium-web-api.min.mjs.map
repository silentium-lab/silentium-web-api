{"version":3,"file":"silentium-web-api.min.mjs","sources":["../src/fetch/FetchedData.ts","../src/fetch/RequestJson.ts","../src/dom/Elements.ts","../src/dom/Element.ts","../src/console/Log.ts","../src/timer/Timer.ts"],"sourcesContent":["import { Message, MessageType, Tap, TapType } from \"silentium\";\n\nexport interface FetchRequestType {\n  baseUrl?: string;\n  url: string;\n  method: string;\n  credentials?: RequestCredentials;\n  headers?: Record<string, string>;\n  body?: unknown;\n  query?: Record<string, unknown>;\n}\n\n/**\n * Wrapper around FetchAPI\n * https://kosukhin.github.io/patron-web-api/#/fetch/fetched\n * https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\n */\nexport function FetchedData(\n  $request: MessageType<Partial<FetchRequestType>>,\n  error?: TapType,\n  $abort?: MessageType,\n) {\n  return Message<string>(function () {\n    const abortController = new AbortController();\n    if ($abort) {\n      $abort.pipe(\n        Tap((abort) => {\n          if (abort) {\n            abortController.abort();\n          }\n        }),\n      );\n    }\n    $request.pipe(\n      Tap((request) => {\n        const { baseUrl, url, method, credentials, headers, body, query } =\n          request;\n        let urlWithQuery: URL;\n        try {\n          urlWithQuery = new URL(String(url), baseUrl);\n        } catch {\n          error?.use(new Error(\"Invalid URL\"));\n          return;\n        }\n        Object.entries(query ?? {}).forEach(([key, value]) =>\n          urlWithQuery.searchParams.append(key, String(value)),\n        );\n        const options: RequestInit = {\n          method,\n          credentials,\n          headers,\n          body: body as BodyInit,\n          signal: abortController.signal,\n        };\n        fetch(urlWithQuery.toString(), options)\n          .then((response) => response.text())\n          .then((data) => this.use(data))\n          .catch((error) => {\n            error?.(error);\n          });\n      }),\n    );\n  });\n}\n","import { Message, MessageType, Tap, TapType } from \"silentium\";\nimport { FetchRequestType } from \"./FetchedData\";\n\n/**\n * Represents a request for JSON data.\n */\nexport function RequestJson(\n  $request: MessageType<Partial<FetchRequestType>>,\n  error?: TapType,\n) {\n  return Message<Partial<FetchRequestType>>(function () {\n    $request.pipe(\n      Tap((r) => {\n        try {\n          this.use({\n            ...r,\n            headers: {\n              ...(r.headers ?? {}),\n              \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify(r.body),\n          });\n        } catch {\n          error?.use(new Error(\"Failed to parse JSON\"));\n        }\n      }),\n    );\n  });\n}\n","import { Message, MessageType, Tap } from \"silentium\";\n\n/**\n * Represents a collection of elements that match a given CSS selector.\n */\nexport function Elements<T extends HTMLElement>(\n  $selector: MessageType<string>,\n) {\n  return Message<T[]>(function () {\n    $selector.pipe(\n      Tap((selector) => {\n        const element = document.querySelectorAll(selector);\n        if (element.length > 0) {\n          this.use(Array.from(element) as T[]);\n        } else {\n          const targetNode = document;\n          const config = {\n            childList: true,\n            subtree: true,\n            attributes: true,\n            attributeFilter: [\"class\", \"id\"],\n          };\n\n          const observer = new MutationObserver((mutationsList) => {\n            for (const mutation of mutationsList) {\n              if (mutation.type === \"childList\") {\n                // Check if any added nodes match the selector or contain matching elements\n                const checkNodes = (nodes: NodeList) => {\n                  for (const node of Array.from(nodes)) {\n                    if (node.nodeType === Node.ELEMENT_NODE) {\n                      const element = node as Element;\n                      if (element.matches && element.matches(selector)) {\n                        const allElements = document.querySelectorAll(selector);\n                        if (allElements.length > 0) {\n                          this.use(Array.from(allElements) as T[]);\n                          observer.disconnect();\n                          return true;\n                        }\n                      }\n                      // Check if this node contains matching elements\n                      if (\n                        element.querySelector &&\n                        element.querySelector(selector)\n                      ) {\n                        const allElements = document.querySelectorAll(selector);\n                        if (allElements.length > 0) {\n                          this.use(Array.from(allElements) as T[]);\n                          observer.disconnect();\n                          return true;\n                        }\n                      }\n                    }\n                  }\n                  return false;\n                };\n\n                if (checkNodes(mutation.addedNodes)) {\n                  break;\n                }\n              } else if (mutation.type === \"attributes\") {\n                // Check if the mutated element now matches the selector\n                const target = mutation.target as Element;\n                if (target.matches && target.matches(selector)) {\n                  const allElements = document.querySelectorAll(selector);\n                  if (allElements.length > 0) {\n                    this.use(Array.from(allElements) as T[]);\n                    observer.disconnect();\n                    break;\n                  }\n                }\n              }\n            }\n          });\n\n          observer.observe(targetNode, config);\n        }\n      }),\n    );\n  });\n}\n","import { Message, MessageType, Tap } from \"silentium\";\n\n/**\n * Represents an element that matches a given CSS selector.\n * If the element exists immediately, returns it.\n * If not, waits for it to appear in the DOM.\n */\nexport function Element<T extends HTMLElement>($selector: MessageType<string>) {\n  return Message<T | null>(function () {\n    $selector.pipe(\n      Tap((selector) => {\n        const element = document.querySelector(selector) as T | null;\n        if (element) {\n          this.use(element);\n        } else {\n          const targetNode = document;\n          const config = {\n            childList: true,\n            subtree: true,\n            attributes: true,\n            attributeFilter: [\"class\", \"id\"],\n          };\n\n          const observer = new MutationObserver((mutationsList) => {\n            for (const mutation of mutationsList) {\n              if (mutation.type === \"childList\") {\n                // Check added nodes and their descendants\n                const checkNodes = (nodes: NodeList) => {\n                  for (const node of Array.from(nodes)) {\n                    if (node.nodeType === Node.ELEMENT_NODE) {\n                      const element = node as Element;\n                      if (element.matches && element.matches(selector)) {\n                        this.use(element as T);\n                        observer.disconnect();\n                        return true;\n                      }\n                      // Check descendants\n                      if (\n                        element.querySelector &&\n                        element.querySelector(selector)\n                      ) {\n                        const found = element.querySelector(selector) as T;\n                        this.use(found);\n                        observer.disconnect();\n                        return true;\n                      }\n                    }\n                  }\n                  return false;\n                };\n\n                if (checkNodes(mutation.addedNodes)) {\n                  break;\n                }\n              } else if (mutation.type === \"attributes\") {\n                // Check if the mutated element now matches the selector\n                const target = mutation.target as Element;\n                if (target.matches && target.matches(selector)) {\n                  this.use(target as T);\n                  observer.disconnect();\n                  break;\n                }\n              }\n            }\n          });\n\n          observer.observe(targetNode, config);\n        }\n      }),\n    );\n  });\n}\n","import { Tap, TapType } from \"silentium\";\n\n/**\n * Transport for log values to console\n */\nexport function Log<T>(group: string): TapType {\n  return Tap<T>((v) => {\n    console.log(group, v);\n  });\n}\n","import { Message } from \"silentium\";\n\nexport function Timer(delay: number) {\n  return Message<number>((t) => {\n    setTimeout(() => {\n      t.use(delay);\n    }, delay);\n  });\n}\n"],"names":["FetchedData","$request","error","$abort","Message","abortController","AbortController","pipe","Tap","abort","request","baseUrl","url","method","credentials","headers","body","query","urlWithQuery","URL","String","use","Error","Object","entries","forEach","key","value","searchParams","append","options","signal","fetch","toString","then","response","text","data","this","catch","RequestJson","r","JSON","stringify","Elements","$selector","selector","element","document","querySelectorAll","length","Array","from","targetNode","config","childList","subtree","attributes","attributeFilter","observer","MutationObserver","mutationsList","mutation","type","nodes","node","nodeType","Node","ELEMENT_NODE","matches","allElements","disconnect","querySelector","checkNodes","addedNodes","target","observe","Element","found","Log","group","v","console","log","Timer","delay","t","setTimeout"],"mappings":"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"}